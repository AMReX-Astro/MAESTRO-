

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MAESTROeX Build System &mdash; MAESTROeX 19.02
 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"rhozero": "{\\rho_0}", "pizero": "{\\pi_0}", "pizeroone": "{\\pi_0^{(1)}}", "pizerotwo": "{\\pi_0^{(2)}}", "gammabar": "{\\overline{\\Gamma}_1}", "ptl": "{\\partial}", "eb": "{{\\bf e}}", "fb": "{{\\bf f}}", "ib": "{{\\bf i}}", "Ub": "{{\\bf U}}", "Vb": "{{\\bf V}}", "xb": "{{\\bf x}}", "ut": "{{\\tilde{u}}}", "vt": "{{\\tilde{v}}}", "wt": "{{\\tilde{w}}}", "Ubt": "{\\widetilde{\\Ub}}", "edge": "{{\\rm EDGE}}", "mac": "{{\\rm MAC}}", "trans": "{{\\rm TRANS}}", "nablab": "{\\mathbf{\\nabla}}", "cdotb": "{\\mathbf{\\cdot}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\frac{1}{2}}", "nph": "{{n + \\myhalf}}", "nmh": "{{n - \\myhalf}}", "Hext": "{{H_{\\rm ext}}}", "Hnuc": "{{H_{\\rm nuc}}}", "kth": "{k_{\\rm th}}", "pred": "{{\\rm pred}}", "Sbar": "{\\overline{S}}", "inp": "{\\mathrm{in}}", "initp": "{\\mathrm{init}}", "outp": "{\\mathrm{out}}", "uadv": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvone": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV},\\star}}", "uadvonedag": "{\\Ubt^{\\mathrm{ADV},\\dagger,\\star}}", "uadvtwo": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvtwodag": "{\\Ubt^{\\mathrm{ADV},\\dagger}}", "uadvsdcstar": "{\\mathbf{U}^{\\mathrm{ADV},\\star}}", "uadvsdcpred": "{\\mathbf{U}^{\\mathrm{ADV},\\mathrm{pred}}}", "uadvsdc": "{\\mathbf{U}^{\\mathrm{ADV}}}", "dt": "{\\Delta t}", "dr": "{\\Delta r}", "etarho": "{\\eta_{\\rho}}", "etarhoec": "{\\etarho^{\\rm ec}}", "etarhocc": "{\\etarho^{\\rm cc}}", "etarhoflux": "{\\etarho^{\\rm flux}}", "divetarho": "{\\nabla\\cdot(\\etarho\\eb_r)}", "ow": "{\\overline{w}_0}", "dw": "{\\delta w_0}", "thalf": "{\\frac{3}{2}}", "rhop": "{{\\rho^{\\prime}}}", "omegadot": "{\\dot{\\omega}}", "er": "{\\mathbf{e}_r}", "ex": "{\\mathbf{e}_x}", "ey": "{\\mathbf{e}_y}", "ez": "{\\mathbf{e}_z}", "Omegab": "{{\\bf \\Omega}}", "rb": "{{\\bf r}}", "boxtype": "{{\\tt box\\/}}", "fab": "{{\\tt fab\\/}}", "multifab": "{{\\tt multifab\\/}}", "boxarray": "{{\\tt boxarray\\/}}", "mlboxarray": "{{\\tt ml\\_boxarray\\/}}", "layout": "{{\\tt layout\\/}}", "mllayout": "{{\\tt ml\\_layout\\/}}", "bctower": "{{\\tt bc\\_tower\\/}}", "bclevel": "{{\\tt bc\\_level\\/}}", "mgtower": "{{\\tt mg\\_tower\\/}}", "bndryreg": "{{\\tt bndry\\_reg\\/}}", "runparam": ["{\\index{Runtime parameters!{\\tt #1}}{\\tt #1}}", 1], "runparamidx": ["{\\index{Runtime parameters!{\\tt #1}}}", 1], "code": ["{\\index{Code reference!{\\tt #1}}{\\tt #1}}", 1], "codeidx": ["{\\index{Code reference!{\\tt #1}}}", 1], "otherindex": ["{\\index{#1!#2}}", 2], "fdamp": "{{f_\\mathrm{damp}}}"}}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Managing Jobs" href="managingjobs.html" />
    <link rel="prev" title="Analysis" href="analysis.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MAESTROeX
          

          
          </a>

          
            
            
              <div class="version">
                19.02

              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">MAESTROeX basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html">MAESTROeX Flowchart</a></li>
</ul>
<p class="caption"><span class="caption-text">Using MAESTROeX</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="common_parameters.html">Common Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">MAESTROeX Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="param_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial_models.html">Initial Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MAESTROeX Build System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-process-overview">Build Process Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#finding-source-files">Finding Source Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-created-at-compile-time">Files Created at Compile-time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#maestro-problem-options">MAESTRO&nbsp;Problem Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#problem-specific-files">Problem-specific Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-eos-network-and-conductivity-routines">Defining EOS, Network, and Conductivity Routines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-maestro-modules">Core MAESTRO&nbsp;modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#amrex-only-tests">AMReX-only Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#special-targets">Special Targets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging">Debugging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print">(print-*)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-locations">file_locations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clean-and-realclean">clean and realclean</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#special-debugging-modes">Special Debugging Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extending-the-build-system">Extending the Build System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-compiler">Adding a Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parallel-mpi-builds">Parallel (MPI) Builds</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="managingjobs.html">Managing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">MAESTROeX technical details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lo_density.html">Low Density Cutoffs</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume_discrepancy.html">Volume Discrepancy Factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="eos_notes.html">Equation of State Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Reaction Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html">The Mixing Term, <span class="math notranslate nohighlight">\(\etarho\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#eta-flow-chart"><span class="math notranslate nohighlight">\(\eta\)</span> Flow Chart</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#computing-etarhoec-and-etarhocc">Computing <span class="math notranslate nohighlight">\(\etarhoec\)</span> and <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhoec">Using <span class="math notranslate nohighlight">\(\etarhoec\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhocc">Using <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="pert.html">Interface State Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdc.html">Spectral Deferred Corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="Godunov.html">Godunov Interface States</a></li>
<li class="toctree-l1"><a class="reference internal" href="mg.html">Multigrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation in MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="spherical_basestate.html">Modifications for a Spherical Self-Gravitating Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="planar_invsq_basestate.html">Modifications for a <span class="math notranslate nohighlight">\(1/r^2\)</span> Plane-Parallel Basestate</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermo_notes.html">Notes on Thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="beta0.html">Notes on <span class="math notranslate nohighlight">\(\beta_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="enthalpy.html">Notes on Enthalpy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAESTROeX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>MAESTROeX Build System</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/makefiles.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="maestroex-build-system">
<h1>MAESTROeX Build System<a class="headerlink" href="#maestroex-build-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="build-process-overview">
<h2>Build Process Overview<a class="headerlink" href="#build-process-overview" title="Permalink to this headline">¶</a></h2>
<p>The MAESTRO&nbsp;build system uses features of GNU make (version 3.81 or
later), which is typically the default on systems. The MAESTRO&nbsp;executable is built in the problem’s directory (one of the directories
under SCIENCE/, TEST_PROBLEMS, or UNIT_TESTS). This
directory will contain a makefile, GNUmakefile, that includes
all the necessary information to build the executable.</p>
<p>The main macros that define the build process are split across several
files. The 4 main files are:</p>
<ul>
<li><p class="first">${AMREX_HOME}/Tools/F_mk/GMakedefs.mak:</p>
<p>This setups the basic macros, includes the options for the selected
compiler, builds the list of object and source files, and defines
the compile and link command lines.</p>
</li>
<li><p class="first">${AMREX_HOME}/Tools/F_mk/GMakeMPI.mak:</p>
<p>This implements any changes to the compiler names and library
locations necessary to build a parallel executable with MPI.</p>
</li>
<li><p class="first">${AMREX_HOME}/Tools/F_mk/GMakerules.mak:</p>
<p>This creates the various build targets and specifies the rules for
building the object files, the list of dependencies, and some other
lesser-used targets (tags for editors, documentation, etc.)</p>
</li>
<li><p class="first">MAESTRO/GMaestro.mak:</p>
<p>This is a MAESTRO-specific file that gathers all of the various
modules that are used to build a typical MAESTRO&nbsp;application
and integrates with the AMReX&nbsp;build system. Every MAESTRO&nbsp;problem’s GNUmakefile will include this file.</p>
</li>
</ul>
<p>MAESTRO&nbsp;gets the location of the AMReX&nbsp;library through the
AMREX_HOME variable. This should be set as an environment
variable in your shell start-up files (e.g.&nbsp;.bashrc or
.cshrc).</p>
<p>The AMReX&nbsp;build system separates the compiler-specific information
from the machine-specific information—this allows for reuse of the
compiler information. The only machine-specific parts of the build system
are for the MPI library locations, contained in GMakeMPI.mak.
The compiler flags for the various compilers are listed in the
files in ${AMREX_HOME}/Tools/F_mk/comps/. The compiler
is set via the COMP variable in the problem’s GNUmakefile.</p>
<p>There are several options in addition to the compiler that affect the
build process: MPI, OMP, and NDEBUG—these turn on/off
MPI parallelization, OpenMP parallelization, and debugging. Together,
these choices along with the compiler name are reflected in the name
of the executable.</p>
<p>When the ‘make’ command is run, the object and module files are
written into a directory t/<em>OS</em>.<em>COMP</em>.<em>other</em>/,
where <em>OS</em> is the operating system detected by the build
system, <em>COMP</em> is the compiler used, and <em>other</em>
reflects any other build options (MPI, OpenMP, debugging, etc.) used.
Separating each build into a separate subdirectory under the problem
directory allows for multiple builds of MAESTRO&nbsp;to exist
side-by-side in the problem directory.</p>
<div class="section" id="finding-source-files">
<h3>Finding Source Files<a class="headerlink" href="#finding-source-files" title="Permalink to this headline">¶</a></h3>
<p>The MAESTRO&nbsp;executable is built from source distributed across a
number of directories. In each of these directories containing source
files, there is a GPackage.mak file. This file has a number of
lines of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f90sources</span> <span class="o">+=</span> <span class="n">file</span><span class="o">.</span><span class="n">f90</span>
</pre></div>
</div>
<p>where file.f90 is a source file that should be built when this
directory is added to the list of build directories. For old
fixed-form Fortran files, the files should be added to the
fsources variable instead of f90sources.</p>
<p>The AMReX&nbsp;build system relies on the vpath functionality of
make. In a makefile, the vpath variable holds search path used
to locate source files. When a particular file is needed, the
directories listed in vpath are searched until the file is
found. The first instance of a file is used. We exploit this feature
by always putting the build directory first in vpath (this is
done in GMakerules.mak). This means that if a source file is
placed in the build directory, that copy will override any other
version in the source path.</p>
<p>In MAESTRO, the vpath variable is set using the macros defined
in GMaestro.mak. A user does not need to set this variable
explicitly. Additional source locations are added in the manner
described below (see §&nbsp;<a class="reference external" href="#sec:make:otherfiles">2.1</a>).</p>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>There is no need to explicitly define the dependencies between the
source files for Fortran modules. The scripts in
AMREX_HOME/Tools/F_scripts/ are run at the start of the build
process and parse all the source files and make an explicit list of
the dependency pairs. The execution of these scripts is triggered
by including makefiles of the form .depends. On a fresh build these
will not exist. When GNU make cannot find an included makefile it will
first attempt to build it using any relevant targets before issuing an
error. The targets for the .depends files contain the recipe for
executing the dependency scripts. Once these makefiles are built by the
scripts GNU make will then read the dependencies for the current build
from them. This process is defined in GMakerules.mak.</p>
<p>A few files use explicit ‘include’ statements to include Fortran
source in other source files. Any include file locations should be
added to Fmincludes variable in the problem’s GNUmakefile.
This does not occur frequently. For the case of the helmholtz
equation of state, this is done automatically in GMaestro.mak.</p>
</div>
<div class="section" id="files-created-at-compile-time">
<h3>Files Created at Compile-time<a class="headerlink" href="#files-created-at-compile-time" title="Permalink to this headline">¶</a></h3>
<p>Several files are created at build-time:</p>
<ul>
<li><p class="first">probin.f90:</p>
<p>This is the module that controls runtime parameters. This is
created by the script
write_probin.py in ${AMREX_HOME}/Tools/F_scripts/. The
makefile logic for creating it is in GMaestro.mak. At compile
time, the problem, main MAESTRO/, and any microphysics
directories (set from the EOS_DIR, CONDUCTIVITY_DIR, and NETWORK_DIR parameters in the GNUmakefile
are searched for _parameter files. These files
are parsed and the probin.f90 file is output containing the
runtime parameters, their default values, and the logic for reading
and interpreting the inputs file.</p>
</li>
<li><p class="first">build_info.f90:</p>
<p>This is a module that contains basic information about the build
environment (compiler used, build machine, build directory, compiler
flags, etc.). This is created by the script makebuildinfo.py
in ${AMREX_HOME}/Tools/F_scripts/ from
GMaestro.mak by passing in a number of makefile variables. This is
rewritten everytime the code is compiled. The primary use of this
module is writing out the job_info file in the plotfiles.</p>
</li>
<li><p class="first">(network.f90):</p>
<p>This is generated at compile time <em>only</em> for the
general_null network. The general_null network allows the
user to define a list of non-reacting species builds the
network.f90 based on this list. The makefile logic for building
the network.f90 is in the GPackage.mak in
Microphysics/networks/general_null. The script write_network.py
in that directory does the actual parsing of the species file and
outputs the network.f90.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="maestro-problem-options">
<h2>MAESTRO&nbsp;Problem Options<a class="headerlink" href="#maestro-problem-options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem-specific-files">
<span id="sec-make-otherfiles"></span><h3>Problem-specific Files<a class="headerlink" href="#problem-specific-files" title="Permalink to this headline">¶</a></h3>
<p>If a problem has a unique file that is needed as part of the build,
then that file should be added to a GPackage.mak file in the
problem’s directory. Since, by default, problems don’t have a
GPackage.mak, the build system needs to be told to look in the
problem directory for unique sources. This is accomplished by adding
the problem’s directory to the EXTRA_DIR variable in the
problem’s GNUmakefile.</p>
<p>Note that this is not necessary if you place a custom version of
a source file in the problem’s directory. Since that file is already
listed in the GPackage.mak in its original location, the build
system will know that it needs to be built. Since the vpath
variable puts the problem’s directory at the start of the search
path, the version of the file in the problem’s directory will be
found first.</p>
</div>
<div class="section" id="defining-eos-network-and-conductivity-routines">
<h3>Defining EOS, Network, and Conductivity Routines<a class="headerlink" href="#defining-eos-network-and-conductivity-routines" title="Permalink to this headline">¶</a></h3>
<p>Each MAESTRO&nbsp;problem needs to define an equation of state, a
reaction network, and a routine to compute the conductivities (for
thermal diffusion). This is true even if the problem is not doing
reactions of thermal diffusion. These definitions are specified
in the problem’s GNUmakefile.</p>
<ul>
<li><p class="first">EOS_DIR:</p>
<p>This variable points to the directory (by default, relative to
Microphysics/EOS/) of the equation of state used for the build.
Choices that work with MAESTRO&nbsp;are:</p>
<ul class="simple">
<li>helmholtz</li>
<li>gamma_law_general</li>
<li>multigamma</li>
</ul>
<p>To use an EOS contained in a different location, set the variable
EOS_TOP_DIR to point to the directory above the alternate EOS
directory.</p>
</li>
<li><p class="first">CONDUCTIVITY_DIR:</p>
<p>This variable points to the conductivity routine used for the build
(by default, relative to Microphysics/conductivity/). Choices
that work with MAESTRO&nbsp;are:</p>
<ul class="simple">
<li>constant</li>
<li>timmes_stellar</li>
</ul>
<p>If diffusion is not being used for the problem, this should be set
to constant. To use an alternate conductivity
routine, set the variable CONDUCTIVITY_TOP_DIR to point
to the directory above the alternate conductivity directory.</p>
</li>
<li><p class="first">NETWORK_DIR:</p>
<p>This variable points to the reaction network used for the build (by
default, relative to Microphysics/networks/). Several options
are present in Microphysics/networks/. A network is required even
if you are not doing reactions, since the network defines the
species that are advected and interpreted by the equation of state.</p>
<p>A special choice, Microphysics/networks/general_null is a general
network that simply defines the properties of one or more species.
This requires an inputs file, specified by
GENERAL_NET_INPUTS. This inputs file is read at compile-time and
used to build the network.f90 file that is compiled into the
source.</p>
<p>To use an alternate reaction network, set the variable
NETWORK_TOP_DIR to point to the directory above the alternate
network.</p>
</li>
</ul>
</div>
<div class="section" id="core-maestro-modules">
<h3>Core MAESTRO&nbsp;modules<a class="headerlink" href="#core-maestro-modules" title="Permalink to this headline">¶</a></h3>
<p>Several modules are included in all MAESTRO&nbsp;builds by default.
From AMReX, we alway include:</p>
<ul class="simple">
<li>${AMREX_HOME}/Src/F_BaseLib</li>
<li>${AMREX_HOME}/Src/LinearSolvers/F_MG</li>
</ul>
<p>From Util, we always include</p>
<ul class="simple">
<li>Util/model_parser</li>
<li>Util/random</li>
</ul>
<p>The microphysics, as described above is also included. For the
networks, we include a file called NETWORK_REQUIRES into
GMaestro.mak that tells us whether to also include Util/VODE
(if NEED_VODE := t). It is assumed in this case that we need
BLAS and LINPACK, so these are compiled in from Util/BLAS and
Util/LINPACK.</p>
<p>You can instead link in a system-wide optimized BLAS library by setting
SYSTEM_BLAS := tGNUmakefile:BLAS in the GNUmakefile. This will
use the library specified in GNUmakefile:BLAS_LIBRARY BLAS_LIBRARY
(defaulting to -lopenblas)
to the link line, and assumes that the library is in your path. Note
that for some systems, you should have the static BLAS libraries
available.</p>
<p>From MAESTRO/, we add</p>
<ul class="simple">
<li>MAESTRO/constants</li>
<li>MAESTRO/Source</li>
</ul>
<p>(although see the unit tests section below regarding MAESTRO/Source.)</p>
<p>Finally, any extra directories listed in the EXTRA_DIR
variable are included.</p>
<p>For each of these included directories, GMaestro.mak adds the
list of source files defined in their GPackage.mak to the list
of files to be compiled. It also adds each of these directories to
the vpath as a directory for the build process to search in for
source files.</p>
</div>
<div class="section" id="unit-tests">
<h3>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h3>
<p>Sometimes we only want to use a few of the standard MAESTRO&nbsp;routines, for example in a unit test where we are testing only a small
part of the MAESTRO&nbsp;algorithm indepenedently. In this case, we
don’t want to comple all of the files in MAESTRO/Source. If we
set UNIT_TEST := t in our problem’s GNUmakefile, then the
GPackage.mak in MAESTRO/Source is not read, so those files
are not automatically put into the list of files to compile. Instead,
the problem should create its own GPackage.mak listing only the
subset of files that are to be compiled. MAESTRO/Source is put
into the vpath search path for sources, so those files will
still be found as needed.</p>
</div>
<div class="section" id="amrex-only-tests">
<h3>AMReX-only Tests<a class="headerlink" href="#amrex-only-tests" title="Permalink to this headline">¶</a></h3>
<p>An even more restrictive setting than UNIT_TEST := t is invoked
by setting AMREX_ONLY := t. This is like the unit test flag,
but does not include MAESTRO/Source in the vpath search
path for sources. So this is intended for cases where we don’t want
to use any MAESTRO&nbsp;source files. Typically, this is used in the
small unit tests that live under the various microphysics solvers. If
a probin.f90 is built for these tests, it will not include all
the MAESTRO-specific parameters, but will include any parameters from
the various microphysics routines.</p>
</div>
</div>
<div class="section" id="special-targets">
<h2>Special Targets<a class="headerlink" href="#special-targets" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<div class="section" id="print">
<h4>(print-*)<a class="headerlink" href="#print" title="Permalink to this headline">¶</a></h4>
<p>To see the contents of any variable in the build system, you can build
the special target print-<em>varname</em>, where is the name of the variable. For example, to see what the
Fortran compiler flags are, you would do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="nb">print</span><span class="o">-</span><span class="n">FFLAGS</span>
</pre></div>
</div>
<p>This would give (for gfortran, for example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FFLAGS</span> <span class="ow">is</span> <span class="o">-</span><span class="n">Jt</span><span class="o">/</span><span class="n">Linux</span><span class="o">.</span><span class="n">gfortran</span><span class="o">/</span><span class="n">m</span> <span class="o">-</span><span class="n">I</span> <span class="n">t</span><span class="o">/</span><span class="n">Linux</span><span class="o">.</span><span class="n">gfortran</span><span class="o">/</span><span class="n">m</span> <span class="o">-</span><span class="n">O2</span> <span class="o">-</span><span class="n">fno</span><span class="o">-</span><span class="nb">range</span><span class="o">-</span><span class="n">check</span>
</pre></div>
</div>
<p>This functionality is useful for debugging the makefiles.</p>
</div>
<div class="section" id="file-locations">
<h4>file_locations<a class="headerlink" href="#file-locations" title="Permalink to this headline">¶</a></h4>
<p>Source files are found by searching through the make
vpath. The first instance of the file found in the vpath
is used in the build. To see which files are used and their locations,
do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">file_locations</span>
</pre></div>
</div>
<p>This will also show any files that aren’t found. Some are expected
(e.g., build_info.f90 and probin.f90 are created at
compile time), but other files that are not found could indicate
an incomplete vpath.</p>
</div>
</div>
<div class="section" id="clean-and-realclean">
<h3>clean and realclean<a class="headerlink" href="#clean-and-realclean" title="Permalink to this headline">¶</a></h3>
<p>Typing ‘make clean’ deleted the object and module files for the
current build (i.e., the current choice of MPI, NDEBUG,
COMP, and OMP). This also removes any of the compile-time
generated source files. Any other builds are left unchanged.</p>
<p>Typing ‘make realclean’ deletes the object and module files for
all builds—i.e., the entire t/ directory is removed.</p>
</div>
</div>
<div class="section" id="special-debugging-modes">
<span id="ch-makefiles-special"></span><h2>Special Debugging Modes<a class="headerlink" href="#special-debugging-modes" title="Permalink to this headline">¶</a></h2>
<p>AMReX&nbsp;has several options that produce executables that can help
track down memory issues, uninitialized variables, NaNs, etc.</p>
<ul>
<li><p class="first">NDEBUG</p>
<p>GNUmakefile:NDEBUG To generate an executable
with debugging information included in the executable (e.g., to be
interpreted by the debugger, gdb), compile with NDEBUG
:=&nbsp;. This will usually add -g to the compile line and
also lower the optimization. For gfortran it will add several
options to catch uninitialize variables, bounds errors, etc.</p>
</li>
<li><p class="first">TEST</p>
<p>Setting TEST := tGNUmakefile:TEST will
enable routines in AMReX&nbsp;initialize multifabs and arrays
allowed via bl_allocate to signalliing NaNs. This behavior
is the same as NDEBUG :=, but TEST := t uses the
same compiler optimizations as a normal build.</p>
<p>This can be useful with compiler flags that trap floating point
exceptions (FPEs), but checks on floating point exceptions can also
be enabled through runtime parameters passed to AMReX’s
backtrace functionlity:</p>
<ul class="simple">
<li>boxlib_fpe_invalid: enabling FPE trapping for
invalid operations (e.g. 0 * inf, sqrt(-1))</li>
<li>boxlib_fpe_zero: enable FPE trapping for
divide-by-zero</li>
<li>boxlib_fpe_overflow: enable FPE trapping for
overflow</li>
</ul>
</li>
<li><p class="first">backtracing</p>
<p>When exception trapping is enabled (either via AMReX&nbsp;or the
compiler), the code will abort, and the backtrace information will
be output to a file Backtrace.N, where N is the
processor number. AMReX&nbsp;will also initialize multifabs with
signaliing NaNs to help uncover any floating point issues.</p>
<p>This is also useful to diagnose deadlocks in parallel regions.
If the code is hanging, doing “control-C” will be intercepted
and the code will generate a backtrace which will identify
where in the code there was a deadlock.</p>
<p>Behind the scenes, AMReX&nbsp;implements this capability via the
Linux/Unix feenableexcept function (this is in
backtrace_c.cpp in AMReX).</p>
</li>
<li><p class="first">FSANITIZER</p>
<p>For gfortran, gcc, g++, setting FSANITIZER :=
tGNUmakefile:FSANITIZER will enable the
address sanitizer support built into GCC. This is enabled through
integration with https://github.com/google/sanitizers in GCC.</p>
<p>Note: you will need to have the libraries libasan and
libubsan installed on your machine to use this functionality.</p>
</li>
</ul>
</div>
<div class="section" id="extending-the-build-system">
<h2>Extending the Build System<a class="headerlink" href="#extending-the-build-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-a-compiler">
<h3>Adding a Compiler<a class="headerlink" href="#adding-a-compiler" title="Permalink to this headline">¶</a></h3>
<p>Properties for different compilers are already defined in
${AMREX_HOME}/Tools/F_mk/comps/. Each compiler is given its
own file. The appropriate file is included into GMakedefs.mak
by looking at the COMP variable and the operating system. These
compiler files define the compiler flags for both optimized and debug
compiling. Additionally, the variable FCOMP_VERSION should be
defined there, based on the output from the compiler, to provide the
compiler version for output into the job_info file at runtime.</p>
</div>
<div class="section" id="parallel-mpi-builds">
<h3>Parallel (MPI) Builds<a class="headerlink" href="#parallel-mpi-builds" title="Permalink to this headline">¶</a></h3>
<p>When building with MPI, the build system needs to know about the
location of the MPI libraries. If your local MPI has the mpif90
and mpicc wrappers installed and working, then MAESTRO&nbsp;will
attempt to use these. Otherwise, you will need to edit
GMakeMPI.mak and add a section specific to your machine with the
compiler and library location. It is best to simply copy an existing
similar portion of the makefile and adjust it to your system. Most
national supercomputing facilities are already supported, and parallel
builds on them should work out of the box.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="managingjobs.html" class="btn btn-neutral float-right" title="Managing Jobs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="analysis.html" class="btn btn-neutral float-left" title="Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, MAESTROeX development tem

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>